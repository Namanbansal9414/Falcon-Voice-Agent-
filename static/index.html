<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Advanced Voice Agent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-card: rgba(15, 23, 42, 0.9);
      --accent: #6366f1;
      --accent-soft: rgba(99, 102, 241, 0.15);
      --accent-strong: #4f46e5;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --text-main: #e5e7eb;
      --text-sub: #9ca3af;
      --danger: #f97373;
      --success: #22c55e;
      --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.7);
      --radius-lg: 18px;
      --radius-pill: 999px;
      --transition-fast: 150ms ease-out;
    }

    html, body {
      height: 100%;
    }

    body.light {
      --bg: #f4f4f5;
      --bg-card: rgba(255, 255, 255, 0.98);
      --accent: #4f46e5;
      --accent-soft: rgba(79, 70, 229, 0.08);
      --accent-strong: #4338ca;
      --border-subtle: rgba(148, 163, 184, 0.5);
      --text-main: #111827;
      --text-sub: #6b7280;
      --danger: #dc2626;
      --success: #16a34a;
      --shadow-soft: 0 16px 40px rgba(15, 23, 42, 0.18);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100%;
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #1e293b 0, #020617 45%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 0;
      transition: background 200ms ease-out, color 200ms ease-out;
    }

    body.light {
      background: radial-gradient(circle at top, #e5e7eb 0, #f9fafb 40%);
    }

    .shell {
      width: 100%;
      max-width: 100%;
      height: 100%;
      background: var(--bg-card);
      border-radius: 0;
      border: 0;
      box-shadow: none;
      padding: 14px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      backdrop-filter: blur(18px);
    }

    @media (min-width: 900px) {
      .shell {
        padding: 18px 30px 20px;
      }
    }

    .header {
      display: flex;
      flex-direction: column;
      gap: 8px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.2);
      padding-bottom: 8px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: center;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-pill {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #a855f7, #6366f1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 17px;
      color: #f9fafb;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.55),
        0 14px 30px rgba(129, 140, 248, 0.6);
    }

    body.light .logo-pill {
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.45),
        0 10px 24px rgba(79, 70, 229, 0.3);
    }

    h1 {
      font-size: 20px;
      font-weight: 650;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid rgba(129, 140, 248, 0.5);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #c7d2fe;
    }

    body.light .badge {
      color: #4f46e5;
    }

    .sub {
      font-size: 12px;
      color: var(--text-sub);
    }

    .stack-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.75);
      color: var(--text-sub);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    body.light .stack-chip {
      background: rgba(248, 250, 252, 0.9);
      color: var(--text-sub);
    }

    .stack-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: linear-gradient(to right, #22c55e, #a855f7);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: rgba(15, 23, 42, 0.8);
      font-size: 11px;
      cursor: pointer;
      user-select: none;
      transition: background 150ms ease-out, border-color 150ms ease-out,
        transform 150ms ease-out;
    }

    body.light .theme-toggle {
      background: rgba(248, 250, 252, 0.9);
    }

    .theme-toggle:hover {
      transform: translateY(-0.5px);
    }

    .theme-toggle-icon {
      font-size: 14px;
    }

    .theme-toggle-label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-sub);
    }

    /* INVEST BANNER (visible only in invest mode via JS) */
    .invest-banner {
      display: none;
      margin-top: 4px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px dashed rgba(251, 191, 36, 0.8);
      background: rgba(250, 204, 21, 0.12);
      font-size: 11px;
      color: #fbbf24;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .invest-banner.visible {
      display: flex;
    }

    body.light .invest-banner {
      background: rgba(250, 204, 21, 0.16);
      color: #92400e;
      border-color: rgba(217, 119, 6, 0.8);
    }

    .invest-banner strong {
      font-weight: 600;
    }

    .main {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(260px, 0.9fr);
      gap: 16px;
      min-height: 0;
    }

    @media (max-width: 900px) {
      .main {
        grid-template-columns: 1fr;
      }
    }

    .left {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }

    .right {
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }

    .agent-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    .agent-card {
      min-width: 150px;
      padding: 6px 10px;
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.8);
      cursor: pointer;
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      transition: border-color 150ms ease-out, background 150ms ease-out,
        transform 150ms ease-out, box-shadow 150ms ease-out;
    }

    .agent-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.7);
    }

    body.light .agent-card {
      background: rgba(248, 250, 252, 0.95);
    }

    .agent-card.active {
      border-color: #818cf8;
      background: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.7);
    }

    .agent-title {
      font-size: 12px;
      font-weight: 600;
    }

    .agent-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .controls-bar {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .controls-top {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
    }

    .mode-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .mode-label {
      font-size: 11px;
      color: var(--text-sub);
      text-transform: uppercase;
      letter-spacing: 0.09em;
    }

    .mode-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 5px 7px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.75);
    }

    body.light .mode-pill {
      background: rgba(248, 250, 252, 0.95);
    }

    .mode-pill select {
      background: transparent;
      border: none;
      color: var(--text-main);
      outline: none;
      font-size: 13px;
      padding: 2px 0;
    }

    .mode-pill span {
      font-size: 11px;
      color: var(--text-sub);
    }

    .mode-pill select option {
      background: #020617;
      color: #e5e7eb;
    }

    body.light .mode-pill select option {
      background: #f9fafb;
      color: #111827;
    }

    .buttons {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .controls-bottom {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    .text-input-shell {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .text-input-shell input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 7px 10px;
      font-size: 13px;
      background: rgba(15, 23, 42, 0.7);
      color: var(--text-main);
      outline: none;
    }

    body.light .text-input-shell input {
      background: rgba(248, 250, 252, 0.98);
    }

    .text-input-shell input::placeholder {
      color: var(--text-sub);
      font-size: 12px;
    }

    button {
      border: none;
      outline: none;
      border-radius: var(--radius-pill);
      padding: 9px 14px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background-color var(--transition-fast),
        transform var(--transition-fast), box-shadow var(--transition-fast),
        opacity var(--transition-fast);
    }

    button:disabled {
      opacity: 0.45;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    #startBtn {
      background: linear-gradient(to right, var(--accent), var(--accent-strong));
      color: #f9fafb;
      box-shadow: 0 12px 28px rgba(79, 70, 229, 0.6);
    }

    #startBtn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(79, 70, 229, 0.8);
    }

    #startBtn:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.7);
    }

    #stopBtn {
      background: rgba(248, 250, 252, 0.06);
      color: #f9fafb;
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    body.light #stopBtn {
      background: rgba(15, 23, 42, 0.04);
      color: #111827;
    }

    #stopBtn:hover:not(:disabled) {
      background: rgba(248, 250, 252, 0.12);
      transform: translateY(-1px);
    }

    body.light #stopBtn:hover:not(:disabled) {
      background: rgba(15, 23, 42, 0.08);
    }

    #stopBtn:active:not(:disabled) {
      transform: translateY(0);
    }

    #stopAudioBtn {
      background: rgba(248, 250, 252, 0.06);
      color: var(--text-main);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 12px;
    }

    body.light #stopAudioBtn {
      background: rgba(15, 23, 42, 0.04);
    }

    #stopAudioBtn:hover:not(:disabled) {
      transform: translateY(-1px);
      background: rgba(248, 250, 252, 0.12);
    }

    body.light #stopAudioBtn:hover:not(:disabled) {
      background: rgba(15, 23, 42, 0.08);
    }

    #downloadBtn {
      background: rgba(15, 23, 42, 0.8);
      color: var(--text-main);
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 12px;
    }

    body.light #downloadBtn {
      background: rgba(248, 250, 252, 0.95);
    }

    #downloadBtn:hover:not(:disabled) {
      background: rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
    }

    body.light #downloadBtn:hover:not(:disabled) {
      background: rgba(229, 231, 235, 0.9);
    }

    #clearBtn {
      background: rgba(30, 64, 175, 0.22);
      color: #bfdbfe;
      border: 1px solid rgba(59, 130, 246, 0.5);
      font-size: 12px;
    }

    body.light #clearBtn {
      background: rgba(59, 130, 246, 0.1);
      color: #1d4ed8;
    }

    #clearBtn:hover {
      transform: translateY(-1px);
      background: rgba(37, 99, 235, 0.3);
    }

    .record-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: var(--danger);
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .record-dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      background: var(--danger);
      box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.7);
      animation: pulse 1200ms infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(248, 113, 113, 0.7);
      }
      70% {
        transform: scale(1.28);
        box-shadow: 0 0 0 10px rgba(248, 113, 113, 0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(248, 113, 113, 0);
      }
    }

    .record-indicator.active {
      opacity: 1;
    }

    .chat {
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      padding: 10px;
      height: 100%;
      min-height: 0;
      overflow-y: auto;
      background: radial-gradient(circle at top, rgba(30, 64, 175, 0.14), transparent),
        rgba(15, 23, 42, 0.92);
    }

    body.light .chat {
      background: radial-gradient(circle at top, rgba(219, 234, 254, 0.9), transparent),
        #f9fafb;
    }

    .msg {
      margin-bottom: 10px;
      display: flex;
    }

    .msg span {
      display: inline-block;
      padding: 7px 10px;
      border-radius: 14px;
      max-width: 80%;
      font-size: 13px;
      line-height: 1.4;
    }

    .msg.user {
      justify-content: flex-end;
    }

    .msg.user span {
      background: linear-gradient(to right, #38bdf8, #6366f1);
      color: #f9fafb;
      border-radius: 16px 4px 16px 16px;
    }

    body.light .msg.user span {
      background: linear-gradient(to right, #0ea5e9, #4f46e5);
    }

    .msg.assistant {
      justify-content: flex-start;
    }

    .msg.assistant span {
      background: rgba(15, 118, 110, 0.15);
      border: 1px solid rgba(45, 212, 191, 0.4);
      border-radius: 4px 16px 16px 16px;
      color: #e0f2f1;
    }

    body.light .msg.assistant span {
      background: rgba(187, 247, 208, 0.8);
      border-color: rgba(22, 163, 74, 0.6);
      color: #064e3b;
    }

    .panel {
      border-radius: 16px;
      border: 1px solid var(--border-subtle);
      padding: 10px 12px;
      background: linear-gradient(to bottom right, rgba(15, 23, 42, 0.9), #020617);
      min-height: 0;
    }

    body.light .panel {
      background: linear-gradient(to bottom right, #ffffff, #e5e7eb);
    }

    .panel-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-sub);
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .pill {
      font-size: 10px;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(156, 163, 175, 0.5);
      color: #e5e7eb;
      background: rgba(15, 23, 42, 0.6);
    }

    body.light .pill {
      color: #111827;
      background: rgba(243, 244, 246, 0.9);
    }

    #metrics {
      font-size: 12px;
      color: var(--text-main);
      margin-top: 4px;
    }

    .tech-list {
      font-size: 12px;
      color: var(--text-sub);
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 4px 6px;
      margin-top: 4px;
    }

    .tech-list span::before {
      content: "‚Ä¢ ";
      opacity: 0.7;
    }

    .hint {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 5px;
      line-height: 1.4;
    }

    .hint strong {
      color: #e5e7eb;
      font-weight: 500;
    }

    body.light .hint strong {
      color: #111827;
    }

    .decision-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .decision-buttons button {
      font-size: 12px;
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
    }

    body.light .decision-buttons button {
      background: rgba(248, 250, 252, 0.95);
    }

    .decision-buttons button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.5);
    }
  </style>
</head>
<body>
  <div class="shell">
    <header class="header">
      <div class="header-top">
        <div class="title-block">
          <div class="title-row">
            <div class="logo-pill">
              VA
            </div>
            <div>
              <h1>
                Voice Agent
                <span class="badge">Real-time AI</span>
              </h1>
              <div class="sub">
                Talk ‚Üí Transcribe (AssemblyAI) ‚Üí Think (Gemini) ‚Üí Speak (Murf Falcon)
              </div>
            </div>
          </div>
        </div>

        <div class="header-right">
          <div class="theme-toggle" id="themeToggle">
            <span class="theme-toggle-icon" id="themeIcon">üåô</span>
            <span class="theme-toggle-label" id="themeLabel">Dark</span>
          </div>
          <div class="stack-chip">
            <span class="stack-dot"></span>
            <span>Python ¬∑ Flask ¬∑ Web</span>
          </div>
        </div>
      </div>

      <!-- INVEST-ONLY BANNER -->
      <div class="invest-banner" id="investBanner">
        ‚ö†Ô∏è <strong>Investment mode:</strong> Educational stock discussion only.
        Not financial advice or a buy/sell recommendation.
      </div>
    </header>

    <section class="main">
      <!-- LEFT SIDE -->
      <div class="left">
        <div class="agent-bar" id="agentBar">
          <!-- You can add data-voice with real Murf voice IDs if you want different voices -->
          <div class="agent-card" data-mode="assistant">
            <div class="agent-title">Support Agent</div>
            <div class="agent-sub">Fast, neutral voice</div>
          </div>
          <div class="agent-card" data-mode="coach">
            <div class="agent-title">Language Coach</div>
            <div class="agent-sub">Friendly corrections</div>
          </div>
          <div class="agent-card" data-mode="assistant">
            <div class="agent-title">Storyteller</div>
            <div class="agent-sub">Expressive narration</div>
          </div>
          <div class="agent-card" data-mode="invest">
            <div class="agent-title">Investment Consultant</div>
            <div class="agent-sub">10+ yrs stock insight</div>
          </div>
        </div>

        <div class="controls-bar">
          <div class="controls-top">
            <div class="mode-group">
              <div class="mode-label">Agent mode</div>
              <div class="mode-pill">
                <select id="mode">
                  <option value="assistant">General Assistant</option>
                  <option value="coach">Language Coach</option>
                  <option value="support">Customer Support</option>
                  <option value="invest">Investment Consultant</option>
                </select>
                <span>Controls LLM persona</span>
              </div>
            </div>

            <div class="buttons">
              <button id="startBtn">
                üéôÔ∏è <span>Start talking</span>
              </button>
              <button id="stopBtn" disabled>
                ‚èπ <span>Stop & send</span>
              </button>
              <button id="stopAudioBtn" disabled>
                üîá Stop audio
              </button>
              <button id="downloadBtn" disabled>
                ‚¨áÔ∏è Transcript
              </button>
              <button id="clearBtn">
                üßπ Clear chat
              </button>
              <div class="record-indicator" id="recordIndicator">
                <div class="record-dot"></div>
                <span>Recording...</span>
              </div>
            </div>
          </div>

          <div class="controls-bottom">
            <div class="text-input-shell">
              <input
                id="textInput"
                type="text"
                placeholder="Type instead of speaking, then press Enter or Send‚Ä¶"
              />
            </div>
            <button id="sendTextBtn">
              ‚û§ Send text
            </button>
          </div>
        </div>

        <div class="chat" id="chat"></div>
      </div>

      <!-- RIGHT SIDE -->
      <div class="right">
        <div class="panel">
          <div class="panel-title">
            Latency & Performance
            <span class="pill">Debug</span>
          </div>
          <div id="metrics">Waiting for first interaction‚Ä¶</div>
        </div>

        <div class="panel">
          <div class="panel-title">
            Stack
            <span class="pill">Architecture</span>
          </div>
          <div class="tech-list">
            <span>Client: MediaRecorder + fetch</span>
            <span>Backend: Flask (Python)</span>
            <span>ASR: AssemblyAI REST API</span>
            <span>LLM: Google Gemini</span>
            <span>TTS: Murf Falcon</span>
          </div>
          <div class="hint">
            Tip: Click different <strong>agents</strong> to switch persona.
            Use <strong>Investment Consultant</strong> when discussing stocks.
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">
            Investment decision helper
            <span class="pill">Invest mode</span>
          </div>
          <div class="hint">
            Use this after you ask about a specific stock in
            <strong>Investment Consultant</strong> mode. It will give an
            educational <strong>buy-side</strong> or
            <strong>don‚Äôt-buy / wait</strong> view ‚Äî not direct advice.
          </div>
          <div class="decision-buttons">
            <button id="buyCaseBtn">üìà Buy-side view</button>
            <button id="noBuyCaseBtn">üö´ Don‚Äôt-buy / Wait view</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // Recording indicator & theme toggle (tiny inline JS).

    const recordIndicator = document.getElementById("recordIndicator");
    const startBtnInline = document.getElementById("startBtn");
    const stopBtnInline = document.getElementById("stopBtn");

    startBtnInline.addEventListener("click", () => {
      recordIndicator.classList.add("active");
    });

    stopBtnInline.addEventListener("click", () => {
      recordIndicator.classList.remove("active");
    });

    const bodyEl = document.body;
    const themeToggle = document.getElementById("themeToggle");
    const themeIcon = document.getElementById("themeIcon");
    const themeLabel = document.getElementById("themeLabel");
    const THEME_KEY = "va-theme";

    function applyTheme(theme) {
      const isLight = theme === "light";
      bodyEl.classList.toggle("light", isLight);
      themeIcon.textContent = isLight ? "‚òÄÔ∏è" : "üåô";
      themeLabel.textContent = isLight ? "Light" : "Dark";
    }

    const savedTheme = localStorage.getItem(THEME_KEY) || "dark";
    applyTheme(savedTheme);

    themeToggle.addEventListener("click", () => {
      const current = bodyEl.classList.contains("light") ? "light" : "dark";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
      localStorage.setItem(THEME_KEY, next);
    });
  </script>

  <script src="/static/app.js"></script>
</body>
</html>
